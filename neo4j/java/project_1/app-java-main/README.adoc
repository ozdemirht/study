:toc:

= Building Neo4j Applications with Java

== Introduction

Prepared as part of link:https://graphacademy.neo4j.com/courses/app-java/[Building Neo4j Applications with Java course^].

== Setup
See link:./setup.adoc[Setup Instructions^]

== High Level Diagram

image::./docs/img/HighLevelArchitectureDiagram.png[High Level Architecture^]

== Data Model

=== Nodes (Entities)

[width="80%",cols="3,20",options="header"]
|=========================================================
|Node |Description
|Movie  | node (entity) represents a movie, and node properties contain release date, title, etc.
|People | node (entity) represents an actor or a director in movies. Node properties contain birth year.
|Genre  | node (entity) represents a genre. Node properties contain label.
|Users  | node (entity) represents a user who rated movies. Node properties contain user's name, etc.
|=========================================================

=== Relationships (edges)

[width="80%",cols="3,20",options="header"]
|=========================================================
|Relationship |Description
|ACTED_IN  | a relationship (edge) from People node to Movie node and represents that a people (source node) acted in a movie (target node).
Properties of relationship contain role.
|DIRECTED | a relationship (edge) from People node to Movie node and represents that a people (source node) directed a movie (target node).
Each director can direct multiple movies.
Each movie can have multiple directors.
|GENRE_IN  | a relationship (edge) from movie node to Genre node and represents which genres a movie has.
Each movie can be in multiple genre (cardinality).
|RATED  | a relationship (edge) from a user node to movie node. Represents rating of movie by a user.
Properties of relationship contain a rating and timestamp of rating event.
Each user rates a movie at most once (constraint).
|=========================================================

== Use Cases


== Solutions

link:./src/main/java/neoflix/NeoflixApp.java[App] configures routes.

=== API : Register User

POST /auth/register

[width="80%",cols="10,40,10,40",options="header"]
|=========================================================
2+| Input Parameters         2+| Output Parameters
| *Name* | *Description*       | *Name* | *Description*
| name   | User's name         | name   | User's name
| email  | User's email        | email  | User's email
| password | User's credential | token  | Bearer Token
|          |                   | userId | User's unique identifier
|=========================================================


image::./docs/img/register-user-Register_User.png[UML Sequence Diagram: Register User^]


=== API : Authenticate User

POST /auth/authenticate

[width="80%",cols="10,40,10,40",options="header"]
|=========================================================
2+| Input Parameters         2+| Output Parameters
| *Name*   | *Description*     | *Name* | *Description*
| name     | User's name       | name   | User's name
| password | User's credential | email  | User's email
|          |                   | token  | Bearer Token
|          |                   | userId | User's unique identifier
|=========================================================

=== API : Get paginated list of people

GET /people/

=== API : Get paginated list of similar people to the given person

GET /people/:id/similar

=== API: Get paginated list of movies that the given person acted in

GET /people/:id/acted

==== Cypher Query

--------------------------------------
MATCH (:Person {tmdbId: $id})-[:ACTED_IN]->(m:Movie)
WHERE m.`%s` IS NOT NULL
RETURN m { .* } AS movie
ORDER BY m.`%s` %s
SKIP $skip
LIMIT $limit
--------------------------------------


=== API: Get paginated list of movies that the given person directed

GET /people/:id/directed

==== Cypher Query

--------------------------------------
MATCH (:Person {tmdbId: $id})-[:DIRECTED]->(m:Movie)
WHERE m.`%s` IS NOT NULL
RETURN m { .* } AS movie
ORDER BY m.`%s` %s
SKIP $skip
LIMIT $limit
--------------------------------------

=== Use Case #1


== Tools

=== Development

- Used link:https://sparkjava.com/[Spark Java^] as Microservices framework to build REST APIs.
- Used link:https://neo4j.com/developer/java[Neo4j Java Driver^] to connect to Neo4j Graph database instance.
- Authentication is handled with link:https://github.com/auth0/auth0-java[Auth0^] and link:https://jwt.io/[JWT Tokens^]
- Passwords are encrypted and verified with link:https://javadoc.io/doc/at.favre.lib/bcrypt/latest/index.html[bcrypt^]. Stored encrypted password in database.

=== Testing

- Testing is performed using link:https://junit.org/junit5/[JUnit5^]

=== Documentation

- Used link:https://asciidoc-py.github.io/index.html[Asciidoc^] to document.
- Used link:https://plantuml.com/[PlantUML^] to add documentation in UML.
- Used link:https://app.diagrams.net/[Draw.io^]

